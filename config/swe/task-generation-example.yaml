# Example configuration for SWE task generation
# This generates bug instances from a GitHub repository using SWE-smith

server:
  base_url: http://localhost:9000
  api_key: 
  request_timeout: 600  # Task generation can take a while

job:
  # Task Generation Pipeline
  task_generation:
    enabled: true
    
    # Repository to generate tasks for
    repository:
      github_url: "pandas-dev/pandas"
      commit: "70c3acf62950be5dfb28743c7a719bfdecebcd84"  # Optional: specific commit
      
      # Mirror repository configuration
      # Option 1: Just specify organization/user
      mirror_org: "your-github-username"  # Creates: your-github-username/pandas-dev__pandas.70c3acf6
      
      # Option 2: Specify full path (org/repo-prefix)
      # mirror_org: "your-org/mirrors"  # Creates: your-org/mirrors-pandas-dev__pandas.70c3acf6
      
      # Option 3: Custom template for repo name
      # mirror_repo_template: "custom-{owner}-{repo}-{commit}"  # Creates: your-org/custom-pandas-dev-pandas-70c3acf6
    
    # Docker image configuration
    docker_image:
      enabled: true
      build_before_tasks: true  # Required: build image before validation
      rebuild_after_tasks: false  # Optional: rebuild after tasks to include branches
      push: false  # Optional: push to Docker Hub
      # Can override mirror settings here
      # mirror_org: "different-org"
      # mirror_repo_template: "custom-{owner}-{repo}-{commit}"
      options:
        workers: 4  # Parallel workers for building
    
    # Bug generation methods
    bug_generation:
      methods:
        # Method 1: PR Mirror (RECOMMENDED) - Invert real PRs for realistic bugs
        # Best training effectiveness (9.2% resolve rate)
        # Requires PR data file from SWE-smith
        - type: "pr_mirror"
          file: "path/to/pr_data.json"  # Path to PR data file
        
        # Method 2: LM Rewrite - LLM rewrites code with bugs
        # Strong training performance (8.8% resolve rate)
        - type: "lm_rewrite"
          config_file: "configs/bug_gen/lm_rewrite.yml"  # SWE-smith config file
          model: "claude-3-7-sonnet-20250219"
          n_bugs: 10
          n_workers: 20
        
        # Method 3: Procedural - AST-based code modifications
        # Strong training performance (8.6% resolve rate), no LLM needed
        - type: "procedural"
          max_bugs: 20
        
        # Method 4: LM Modify - LLM modifies code to introduce bugs
        # Weaker training performance (5.7% resolve rate)
        # - type: "lm_modify"
        #   config_file: "configs/bug_gen/lm_modify.yml"
        #   model: "claude-3-7-sonnet-20250219"
        #   n_bugs: 10
      
      # Optional: Combine bugs from multiple methods
      combine:
        enabled: true
        same_file:
          num_patches: 3
          limit_per_file: 15
        same_module:
          num_patches: 2
          depth: 2
    
    # Validation: Run test harness to ensure bugs break tests
    validation:
      enabled: true
      workers: 8
    
    # Gather: Collect validated tasks into task instances
    gather:
      enabled: true
    
    # Optional: Generate issue text for tasks
    issue_generation:
      enabled: false
      config_file: "configs/issue_gen/ig_v2.yaml"
      model: "claude-3-7-sonnet-20250219"
      workers: 2
  
  # Task Output: Upload generated tasks to HuggingFace
  task_output:
    mode: "upload_hf"
    hf:
      repo_id: "my-org/pandas-swe-tasks"
      repo_type: "dataset"
      private: false
  
  # Model config (not used for task generation, but required by JobConfig)
  model:
    provider: "vllm"
    name: "dummy"  # Not used for task generation
  
  # Source config (not used for task generation, but required by JobConfig)
  source:
    dataset: "dummy"
    split: "train"
  
  # Generation config (not used for task generation, but required by JobConfig)
  generation:
    max_turns: 1
  
  # Output config (not used for task generation, but required by JobConfig)
  output:
    mode: "return"

